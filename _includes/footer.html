<footer
  aria-label="Site Info"
  class="
    d-flex flex-column justify-content-center text-muted
    flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
  <div class="container">
  <p class="text-center text-muted">
    {{- '©' }}
    <time>{{ 'now' | date: '%Y' }}</time>

    {% if site.social.links %}
      <a href="{{ site.social.links[0] }}">{{ site.social.name }}</a>.
    {% else %}
      <em class="fst-normal">{{ site.social.name }}</em>.
    {% endif %}

    {% if site.data.locales[include.lang].copyright.brief %}
      <span
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="{{ site.data.locales[include.lang].copyright.verbose }}"
      >
        {{- site.data.locales[include.lang].copyright.brief -}}
      </span>
    {% endif %}
  </p>
  </div>

  <!-- 【中文目录修复脚本 - 性能优化版 (Zero-Overhead)】 -->
  <script>
  (function() {
    // 性能优化版：不再轮询 tocbot，直接使用原生事件捕获拦截点击
    // 这种方式对页面加载速度的影响为 0
    
    var TOC_ID = 'toc';
    var SCROLL_OFFSET = 30; // 留白高度，可按需微调

    function initTocFix() {
      var toc = document.getElementById(TOC_ID);
      
      // 如果页面没有目录，直接退出，不占用资源
      if (!toc) return;

      // 使用 { capture: true } 捕获模式
      // 这意味着我们的函数会在 tocbot 插件收到点击事件之前运行
      toc.addEventListener('click', function(e) {
        var link = e.target.closest('a');
        if (!link) return;

        var href = link.getAttribute('href');
        // 只处理内部锚点链接
        if (!href || !href.startsWith('#')) return;

        // 1. 阻止默认行为（阻止浏览器直接跳，也阻止 tocbot 处理）
        e.preventDefault();
        e.stopPropagation(); // 关键：停止事件传播，防止 tocbot 干扰

        // 2. 解码中文 ID
        var targetId = decodeURIComponent(href.substring(1));
        var targetEl = document.getElementById(targetId);
        // 兼容性查找
        if (!targetEl) targetEl = document.getElementsByName(targetId)[0];

        if (targetEl) {
          // 3. 计算位置并平滑滚动
          var top = targetEl.getBoundingClientRect().top + window.scrollY - SCROLL_OFFSET;
          
          window.scrollTo({
            top: top,
            behavior: 'smooth'
          });

          // 4. 手动更新 URL
          history.pushState(null, null, href);

          // 5. 辅助高亮（视觉反馈）
          // 移除旧高亮
          var activeLinks = toc.querySelectorAll('.is-active-link');
          for (var i = 0; i < activeLinks.length; i++) {
            activeLinks[i].classList.remove('is-active-link');
          }
          // 添加新高亮
          link.classList.add('is-active-link');
        }
      }, true); // <--- true 表示捕获阶段，这非常重要！
      
      console.log(">>> TOC Fix: Capture interceptor attached. <<<");
    }

    // 在 DOM 准备好后立即绑定，无需等待所有资源加载完成
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initTocFix);
    } else {
      initTocFix();
    }

  })();
  </script>
</footer>